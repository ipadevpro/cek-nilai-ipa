<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Rapor Kamu Slay ✨</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Poppins:wght@500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
  <style>
    :root {
      --primary: #7F5AF0;
      --primary-dark: #6B46E5;
      --secondary: #2CB67D;
      --bg-color: #16161A;
      --surface: #242629;
      --light-text: #FFFFFE;
      --light-para: #94A1B2;
      --accent: #FF8906;
      --danger: #FF5470;
    }
    * { 
      box-sizing: border-box; 
      font-family: 'Inter', sans-serif; 
      transition: all 0.3s ease; 
    }
    body { 
      margin: 0; 
      padding: 0; 
      background: var(--bg-color); 
      color: var(--light-text);
      background-image: 
        radial-gradient(circle at 25% 10%, rgba(127, 90, 240, 0.2) 0%, transparent 20%),
        radial-gradient(circle at 75% 75%, rgba(44, 182, 125, 0.1) 0%, transparent 20%),
        radial-gradient(circle at 50% 50%, rgba(255, 137, 6, 0.05) 0%, transparent 50%);
      min-height: 100vh;
      background-attachment: fixed;
    }
    .container { 
      max-width: 500px; 
      margin: auto; 
      padding: 20px; 
    }

    .card {
      background: var(--surface); 
      padding: 25px; 
      border-radius: 20px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.2); 
      margin-bottom: 24px;
      border: 1px solid rgba(255,255,255,0.05);
      backdrop-filter: blur(10px);
      transform: translateY(0);
    }
    
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 28px rgba(0,0,0,0.25);
    }

    .title { 
      font-family: 'Poppins', sans-serif;
      font-size: 1.8em; 
      font-weight: 700; 
      text-align: center; 
      margin-bottom: 15px; 
      background: linear-gradient(to right, var(--primary), var(--accent));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 2px 10px rgba(127, 90, 240, 0.3);
    }
    
    .input-group { 
      margin-bottom: 18px; 
    }
    
    .input-group input {
      width: 100%; 
      padding: 16px; 
      background: rgba(255,255,255,0.05);
      color: var(--light-text);
      border: 1px solid rgba(255,255,255,0.1); 
      border-radius: 12px;
      font-size: 0.95rem;
    }
    
    .input-group input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(127, 90, 240, 0.3);
    }

    .btn {
      background: var(--primary); 
      color: white; 
      padding: 16px;
      border: none; 
      border-radius: 12px; 
      width: 100%; 
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(127, 90, 240, 0.3);
      text-transform: uppercase;
      letter-spacing: 1px;
      position: relative;
      overflow: hidden;
    }
    
    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: 0.5s;
    }
    
    .btn:hover { 
      background: var(--primary-dark);
      transform: translateY(-2px);
    }
    
    .btn:hover::before {
      left: 100%;
    }

    .tab-menu {
      display: flex; 
      justify-content: space-between;
      margin: 10px 0; 
      border-radius: 14px; 
      overflow: hidden;
      background: rgba(255,255,255,0.05);
      padding: 5px;
      backdrop-filter: blur(5px);
    }
    
    .tab-btn {
      flex: 1; 
      padding: 12px; 
      text-align: center;
      border-radius: 10px;
      background: transparent; 
      cursor: pointer; 
      font-weight: 500;
      color: var(--light-para);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 5px;
    }
    
    .tab-btn span {
      font-size: 1.2rem;
    }
    
    .tab-btn.active {
      background: var(--primary);
      color: white;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .tab-content { 
      display: none; 
    }
    
    .tab-content.active { 
      display: block; 
      animation: fadeIn 0.5s;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    .progress-bar {
      background: rgba(255,255,255,0.1);
      height: 12px; 
      border-radius: 10px; 
      overflow: hidden;
    }
    
    .progress-fill {
      height: 12px; 
      width: 0%; 
      background: linear-gradient(to right, var(--primary), var(--accent));
      transition: width 1s cubic-bezier(0.19, 1, 0.22, 1);
    }

    .badge-box {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      padding: 20px; 
      border-radius: 16px; 
      margin-bottom: 18px;
      position: relative;
      overflow: hidden;
      transition: transform 0.3s, box-shadow 0.3s;
    }
    
    .badge-box:hover {
      transform: translateY(-5px) scale(1.02);
      box-shadow: 0 10px 20px rgba(0,0,0,0.2);
    }
    
    .badge-box::before {
      content: "";
      position: absolute;
      top: -10px;
      right: -10px;
      width: 80px;
      height: 80px;
      background: var(--primary);
      opacity: 0.1;
      border-radius: 50%;
    }
    
    .badge-emoji {
      font-size: 3rem;
      margin-bottom: 10px;
      text-shadow: 0 0 15px rgba(255,255,255,0.3);
      display: inline-block;
      animation: pulse 2s infinite;
    }
    
    .badge-name {
      font-weight: bold;
      margin-bottom: 5px;
      font-family: 'Poppins', sans-serif;
      font-size: 1.2rem;
      background: linear-gradient(to right, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .badge-desc {
      color: var(--light-para);
      font-size: 0.9rem;
    }

    .stat-item { 
      margin-bottom: 20px; 
      border-radius: 10px;
      padding: 15px;
      background: rgba(255,255,255,0.02);
      transition: transform 0.3s;
    }
    
    .stat-item:hover {
      transform: translateX(5px);
      background: rgba(255,255,255,0.05);
    }
    
    .stat-label {
      display: flex; 
      justify-content: space-between;
      font-size: 0.95em; 
      font-weight: 500;
      margin-bottom: 8px;
    }
    
    .stat-value {
      font-weight: bold;
      color: var(--primary);
    }

    .footer {
      text-align: center; 
      font-size: 0.85em; 
      color: var(--light-para);
      margin-top: 40px;
      padding-bottom: 20px;
    }

    .hidden { 
      display: none; 
    }
    
    .centered { 
      text-align: center; 
    }
    
    /* Matrix effect */
    .login-animation {
      height: 150px;
      overflow: hidden;
      position: relative;
      margin-bottom: 20px;
      background: rgba(0,0,0,0.2);
      border-radius: 15px;
    }
    
    /* Sparkles */
    .sparkle {
      position: absolute;
      width: 5px;
      height: 5px;
      border-radius: 50%;
      background-color: white;
      pointer-events: none;
      z-index: 10;
      opacity: 0;
      animation: sparkle-animation 1s ease-in-out;
    }
    
    @keyframes sparkle-animation {
      0% { transform: scale(0); opacity: 0; }
      20% { transform: scale(1); opacity: 1; }
      100% { transform: scale(0); opacity: 0; }
    }
    
    /* Status tag */
    .status-tag {
      display: inline-block;
      padding: 5px 10px;
      border-radius: 10px;
      font-size: 0.75rem;
      font-weight: bold;
      margin-left: 10px;
      text-transform: uppercase;
      background: var(--primary);
      color: white;
      vertical-align: middle;
    }
    
    /* User profile */
    .user-profile {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 15px;
    }
    
    .user-avatar {
      width: 60px;
      height: 60px;
      background: linear-gradient(45deg, var(--primary), var(--secondary));
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      color: white;
      box-shadow: 0 5px 15px rgba(127, 90, 240, 0.3);
    }
    
    .user-info {
      flex: 1;
    }
    
    .user-name {
      font-size: 1.2rem;
      font-weight: bold;
      margin: 0 0 5px 0;
      font-family: 'Poppins', sans-serif;
    }
    
    .user-details {
      color: var(--light-para);
      font-size: 0.9rem;
      margin: 0;
    }
    
    /* XP Bar */
    .xp-container {
      background: rgba(127, 90, 240, 0.1);
      border-radius: 12px;
      padding: 15px;
      margin: 15px 0;
    }
    
    .xp-bar {
      height: 8px;
      background: rgba(0,0,0,0.2);
      border-radius: 4px;
      overflow: hidden;
      margin: 8px 0;
    }
    
    .xp-fill {
      height: 100%;
      background: linear-gradient(to right, var(--primary), var(--accent));
      border-radius: 4px;
      width: 0%;
      transition: width 1.5s cubic-bezier(0.19, 1, 0.22, 1);
    }
    
    .xp-details {
      display: flex;
      justify-content: space-between;
      font-size: 0.85rem;
      color: var(--light-para);
    }
    
    /* For mobile */
    @media (max-width: 600px) {
      .container {
        padding: 15px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Login -->
    <div id="login-card" class="card animate__animated animate__fadeIn">
      <div class="title">Dashboard Pencapaian Kamu💅✨</div>
      <div class="login-animation" id="login-animation"></div>
      <p class="centered" style="margin-top: -5px; font-size: 0.95em; color: var(--light-para);">Login dulu bestie, biar bisa flexing nilai-nilai! 🚀</p>
      <div class="input-group"><input type="text" id="username" placeholder="Username kamu"></div>
      <div class="input-group"><input type="password" id="password" placeholder="Password rahasia..."></div>
      <button class="btn" onclick="login()">Gaskeun!</button>
      <p id="login-message" class="centered" style="color:var(--danger);margin-top:10px;"></p>
    </div>

    <!-- Dashboard -->
    <div id="dashboard-card" class="card hidden animate__animated animate__fadeIn">
      <div class="user-profile">
        <div class="user-avatar" id="user-avatar"></div>
        <div class="user-info">
          <h2 id="nama-siswa" class="user-name"></h2>
          <p class="user-details"><span id="nis-siswa"></span> • <span id="kelas-siswa"></span></p>
        </div>
      </div>

      <div class="xp-container">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div style="font-weight:700;color:var(--primary);">Level <span id="level"></span> <span class="status-tag" id="status-tag">Newbie</span></div>
          <div style="color:var(--light-para)"><span id="xp"></span> XP</div>
        </div>
        <div class="xp-bar">
          <div class="xp-fill" id="xp-fill"></div>
        </div>
        <div class="xp-details">
          <span>Ranking #<span id="rank"></span> dari <span id="total-siswa"></span></span>
          <span id="next-level">Next: 1000 XP</span>
        </div>
      </div>
      
      <button class="btn" onclick="refreshData()" style="background:var(--secondary); margin-top: 15px;">🔄 Refresh</button>
    </div>

    <!-- Tab Menu -->
    <div class="tab-menu hidden animate__animated animate__fadeIn" id="tab-menu">
      <div class="tab-btn active" onclick="switchTab('nilai')"><span>📊</span> Nilai</div>
      <div class="tab-btn" onclick="switchTab('badge')"><span>🏆</span> Badge</div>
      <div class="tab-btn" onclick="switchTab('pesan')"><span>💌</span> Tea</div>
    </div>
    
    <!-- Tab Nilai -->
    <div id="tab-nilai" class="tab-content card hidden">
      <div class="title">Statistik Nilai Kamu 📊</div>
      <p class="centered" style="margin-top:-10px;color:var(--light-para);font-size:0.9rem;margin-bottom:20px;">
        Pamer ke bestie nilai kamu 💯
      </p>
      <div id="stat-list"></div>
    </div>

    <!-- Tab Badge -->
    <div id="tab-badge" class="tab-content card hidden">
      <div class="title">Badge Kece Kamu 🏆</div>
      <p class="centered" style="margin-top:-10px;color:var(--light-para);font-size:0.9rem;margin-bottom:20px;">
        Koleksi achievement buat story IG 📸
      </p>
      <div id="badge-container"></div>
    </div>

    <!-- Tab Pesan Guru -->
    <div id="tab-pesan" class="tab-content card hidden">
      <div class="title">Spill Tea dari Guru 🍵</div>
      <p class="centered" style="margin-top:-10px;color:var(--light-para);font-size:0.9rem;margin-bottom:20px;">
        Dengar nasihat, jiwa sehat 🧘‍♂️
      </p>
      <div style="background:rgba(255,255,255,0.05);padding:20px;border-radius:15px;">
        <p id="pesan-guru" style="font-size:1.1em;color:var(--light-text);line-height:1.6;"></p>
      </div>
    </div>

    <!-- Logout -->
    <div id="logout-card" class="card hidden centered">
      <button class="btn" onclick="logout()" style="background:var(--danger);">👋 Logout</button>
    </div>

    <div class="footer">developed with ☕, pixels & a sprinkle of ✨ by Devi Saidulloh, S.Pd.</div>
  </div>

  <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbykzhQiGRm4wdZMDs-oJKGMzuSUbXATS9JzDODup_esQlCvVzZ6oo8NP9OXNBwGR2rpTw/exec";
    let cachedData = null;
    
    // Matrix-like effect for login
    function setupMatrixEffect() {
      const canvas = document.createElement('canvas');
      const container = document.getElementById('login-animation');
      container.appendChild(canvas);
      
      canvas.width = container.offsetWidth;
      canvas.height = container.offsetHeight;
      
      const ctx = canvas.getContext('2d');
      const chars = '10'.split('');
      const columns = canvas.width / 15;
      const drops = [];
      
      for(let i = 0; i < columns; i++) {
        drops[i] = Math.floor(Math.random() * canvas.height / 15);
      }
      
      function draw() {
        ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        ctx.fillStyle = '#7F5AF0';
        ctx.font = '15px monospace';
        
        for(let i = 0; i < drops.length; i++) {
          const text = chars[Math.floor(Math.random() * chars.length)];
          ctx.fillText(text, i * 15, drops[i] * 15);
          
          if(drops[i] * 15 > canvas.height && Math.random() > 0.975) {
            drops[i] = 0;
          }
          
          drops[i]++;
        }
      }
      
      setInterval(draw, 100);
    }
    
    // Create sparkle effect
    function createSparkle(e) {
      const sparkle = document.createElement('div');
      sparkle.className = 'sparkle';
      document.body.appendChild(sparkle);
      
      // Position the sparkle where clicked
      sparkle.style.left = e.pageX + 'px';
      sparkle.style.top = e.pageY + 'px';
      
      // Remove after animation completes
      setTimeout(() => {
        sparkle.remove();
      }, 1000);
    }
    
    // Add sparkle effect to clickable elements
    function addSparkleEffects() {
      const clickables = document.querySelectorAll('.btn, .tab-btn, .badge-box');
      clickables.forEach(element => {
        element.addEventListener('click', createSparkle);
      });
    }
    
    // Original functionality
    function login() {
      const u = document.getElementById("username").value.trim();
      const p = document.getElementById("password").value.trim();
      document.getElementById("login-message").innerText = "";

      if (!u || !p) {
        document.getElementById("login-message").innerText = "Isi dulu dong bestie~! 🙄✋";
        return;
      }

      const formData = new FormData();
      formData.append("username", u);
      formData.append("password", p);

      fetch(SCRIPT_URL, {
        method: "POST",
        body: formData
      })
      .then(res => res.json())
      .then(data => {
        cachedData = data;
        handleLogin(data);
      })
      .catch(() => {
        document.getElementById("login-message").innerText = "Waduh server-nya down bestie, coba lagi nanti ya 😵";
      });
    }

    function refreshData() {
      if (cachedData) handleLogin(cachedData);
    }

    function handleLogin(res) {
      if (res.status === "ok") {
        document.getElementById("login-card").classList.add("hidden");
        ["dashboard-card", "tab-menu", "tab-nilai", "logout-card"].forEach(id =>
          document.getElementById(id).classList.remove("hidden")
        );

        // Set user avatar initials
        const namaParts = res.nama.split(' ');
        const initials = namaParts.length > 1 
          ? namaParts[0][0] + namaParts[1][0]
          : namaParts[0][0];
        document.getElementById("user-avatar").innerText = initials;
        
        // Set user info
        document.getElementById("nama-siswa").innerText = res.nama;
        document.getElementById("nis-siswa").innerText = res.nis;
        document.getElementById("kelas-siswa").innerText = res.kelas;
        document.getElementById("xp").innerText = res.xp;
        document.getElementById("level").innerText = res.level;
        document.getElementById("rank").innerText = res.ranking;
        document.getElementById("total-siswa").innerText = res.total_siswa;
        document.getElementById("pesan-guru").innerText = res.pesan_guru;
        
        // Set XP status tag based on level
        const level = parseInt(res.level);
        let status = "Newbie";
        if (level >= 10) status = "Legend";
        else if (level >= 7) status = "Pro";
        else if (level >= 5) status = "Expert";
        else if (level >= 3) status = "Rising";
        document.getElementById("status-tag").innerText = status;
        
        // Set XP bar percentage (assuming max XP is 1000 per level)
        const xp = parseInt(res.xp);
        const xpPerLevel = 1000;
        const currentLevelXp = xp % xpPerLevel;
        const xpPercentage = (currentLevelXp / xpPerLevel) * 100;
        document.getElementById("xp-fill").style.width = xpPercentage + "%";
        document.getElementById("next-level").innerText = `Next: ${xpPerLevel - currentLevelXp} XP`;

        // Badge
        const badgeContainer = document.getElementById("badge-container");
        badgeContainer.innerHTML = "";
        for (let i = 0; i < res.emoji.length; i++) {
          badgeContainer.innerHTML += `
            <div class="badge-box centered">
              <div class="badge-emoji">${res.emoji[i]}</div>
              <div class="badge-name">${res.badge_name[i]}</div>
              <div class="badge-desc">${res.badge_desc[i]}</div>
            </div>`;
        }

        // Nilai
        const list = document.getElementById("stat-list");
        list.innerHTML = "";
        for (let i = 0; i < res.mapel.length; i++) {
          const nilai = parseInt(res.nilai[i]) || 0;
          const barID = "bar" + i;
          
          // Add emoji based on score
          let scoreEmoji = "🔥"; // default
          if (nilai >= 90) scoreEmoji = "🔥";
          else if (nilai >= 80) scoreEmoji = "💯";
          else if (nilai >= 70) scoreEmoji = "👌";
          else if (nilai >= 60) scoreEmoji = "👍";
          else scoreEmoji = "🙏";
          
          list.innerHTML += `
            <div class="stat-item">
              <div class="stat-label">
                <span>${res.mapel[i]}</span>
                <span class="stat-value">${nilai} ${scoreEmoji}</span>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" id="${barID}"></div>
              </div>
            </div>`;
            
          setTimeout(() => {
            document.getElementById(barID).style.width = nilai + "%";
          }, 100);
        }

        switchTab("nilai");
        addSparkleEffects();
      } else {
        document.getElementById("login-message").innerText = "Login failed bestie! Password salah kali? 🙈";
      }
    }

    function switchTab(tab) {
      document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove("active"));
      document.querySelectorAll('.tab-content').forEach(el => {
        el.classList.remove("active");
        el.classList.add("hidden");
      });

      if (tab === "nilai") {
        document.querySelectorAll('.tab-btn')[0].classList.add("active");
        document.getElementById("tab-nilai").classList.add("active");
        document.getElementById("tab-nilai").classList.remove("hidden");
      } else if (tab === "badge") {
        document.querySelectorAll('.tab-btn')[1].classList.add("active");
        document.getElementById("tab-badge").classList.add("active");
        document.getElementById("tab-badge").classList.remove("hidden");
      } else if (tab === "pesan") {
        document.querySelectorAll('.tab-btn')[2].classList.add("active");
        document.getElementById("tab-pesan").classList.add("active");
        document.getElementById("tab-pesan").classList.remove("hidden");
      }
    }

    function logout() {
      location.reload();
    }
    
    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      setupMatrixEffect();
      addSparkleEffects();
    });
  </script>
</body>
</html>
